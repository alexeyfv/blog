---
import { slugifyTag } from '@/utils'

export const prerender = true

export function GET({ params }) {
  const slugPart = params.slug

  if (!slugPart) {
    // Safety guard: direct bare /tag/ in case Google hits it without a slug
    return Astro.redirect('/en/tags/', 308)
  }

  // Normalize and forward old /tag/<slug> URLs Google still reports to the canonical slug paths
  const normalizedSlug = slugifyTag(Array.isArray(slugPart) ? slugPart.join('/') : slugPart)

  return Astro.redirect(`/en/tags/${normalizedSlug}/`, 308)
}
