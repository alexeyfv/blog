---
import BaseLayout from '@/layouts/BaseLayout'
import ListPosts from '@/components/ListPosts'
import TitlePage from '@/components/TitlePage'
import { getTags, getPostByTag, slugifyTag } from '@/utils'
import { Lang, ui, getTranslation } from '@/i18n/utils'

export const getStaticPaths = async () => {
  const result: any[] = []

  for (const lang of Object.keys(ui)) {
    const tags = await getTags(lang as Lang)

    for (const originalTag of tags) {
      const tag = slugifyTag(originalTag)

      result.push({
        params: { lang, tag, tagTitle: originalTag },
        props: { tag, tagTitle: originalTag },
      })
    }
  }

  return result
}

const lang: Lang = Astro.params.lang
const { tag, tagTitle } = Astro.props
const posts = await getPostByTag(lang, tag)
const t = getTranslation(lang)
const langMarker = lang.toUpperCase()
const detailTitle = `${t.tags.detailTitlePrefix}${tagTitle} (${langMarker})`
const detailDescription = `${t.tags.detailDescriptionPrefix}${tagTitle}${t.tags.detailDescriptionSuffix}`
---

<BaseLayout lang={lang} title={detailTitle} description={detailDescription}>
  <TitlePage title={tagTitle} />
  <ListPosts posts={posts} />
</BaseLayout>
