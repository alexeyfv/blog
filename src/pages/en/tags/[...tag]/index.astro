---
import BaseLayout from '@/layouts/BaseLayout'
import ListPosts from '@/components/ListPosts'
import TitlePage from '@/components/TitlePage'
import { getTags, getPostByTag } from '@/utils'
import { getLangFromUrl } from '@/i18n/utils'
import { slugifyTag } from 'src/utils/slugify'

export const getStaticPaths = async () => {
  // hardcoded lang
  const tags = await getTags('en')

  return tags.map((tag) => {
    const tagTitle = tag
    tag = slugifyTag(tag)
    return {
      params: { tag, tagTitle },
      props: { tag, tagTitle },
    }
  })
}

const { tag, tagTitle } = Astro.props

const lang = getLangFromUrl(Astro.url)
const posts = await getPostByTag(lang, tag)
---

<BaseLayout lang={lang} title={tagTitle}>
  <TitlePage title={tagTitle} />
  <ListPosts posts={posts} />
</BaseLayout>
